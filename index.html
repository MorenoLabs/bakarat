<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baccarat Pro - Strategy Tracker & Simulator</title>
    <style>
        :root {
            --color-primary: #1f5c7f;
            --color-primary-hover: #174a67;
            --color-success: #22b55e;
            --color-error: #d32f2f;
            --color-warning: #f59e0b;
            --color-bg: #f5f5f0;
            --color-surface: #ffffff;
            --color-text: #1a1a1a;
            --color-text-light: #666666;
            --color-border: #e0e0e0;
        }

        * { box-sizing: border-box; }

        html, body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text);
        }

        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }

        header {
            background-color: var(--color-primary);
            color: white;
            padding: 24px 20px 0 20px;
            margin: -20px -20px 0 -20px;
        }

        h1 { margin: 0; font-size: 28px; font-weight: 600; }

        .header-subtitle { font-size: 14px; opacity: 0.9; margin-top: 4px; margin-bottom: 20px; }

        .nav-tabs { display: flex; gap: 0; margin: 0 -20px; padding: 0 20px; }

        .nav-tab {
            padding: 14px 24px;
            background: rgba(255,255,255,0.1);
            border: none;
            color: rgba(255,255,255,0.8);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border-radius: 8px 8px 0 0;
            margin-right: 4px;
        }

        .nav-tab:hover { background: rgba(255,255,255,0.2); color: white; }
        .nav-tab.active { background: var(--color-bg); color: var(--color-primary); }

        .tab-content { display: none; padding-top: 30px; }
        .tab-content.active { display: block; }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 30px; }

        @media (max-width: 900px) {
            .grid { grid-template-columns: 1fr; }
            .nav-tab { padding: 12px 16px; font-size: 13px; }
        }

        .card {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            margin-bottom: 24px;
        }

        .card h2 { margin: 0 0 16px 0; font-size: 18px; font-weight: 600; color: var(--color-primary); }

        .form-group { margin-bottom: 16px; }

        label { display: block; font-size: 13px; font-weight: 500; margin-bottom: 6px; color: var(--color-text); }

        input[type="number"], select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--color-border);
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
        }

        input[type="number"]:focus, select:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(31, 92, 127, 0.1);
        }

        .button-group { display: flex; gap: 10px; margin-top: 20px; }

        button {
            flex: 1;
            padding: 12px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary { background-color: var(--color-primary); color: white; }
        .btn-primary:hover { background-color: var(--color-primary-hover); }
        .btn-secondary { background-color: #f0f0f0; color: var(--color-text); }
        .btn-secondary:hover { background-color: #e0e0e0; }
        .btn-small { padding: 8px 12px; font-size: 12px; flex: none; }

        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 16px; }

        @media (max-width: 600px) { .stats-grid { grid-template-columns: repeat(2, 1fr); } }

        .stat-box {
            background: var(--color-bg);
            border-radius: 6px;
            padding: 12px;
            text-align: center;
            border-left: 3px solid var(--color-primary);
        }

        .stat-label { font-size: 12px; color: var(--color-text-light); margin-bottom: 4px; }
        .stat-value { font-size: 20px; font-weight: 600; color: var(--color-text); }

        .table-wrapper { overflow-x: auto; }

        table { width: 100%; border-collapse: collapse; font-size: 14px; }

        th {
            background-color: var(--color-bg);
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: var(--color-text);
            border-bottom: 2px solid var(--color-border);
        }

        td { padding: 12px; border-bottom: 1px solid var(--color-border); }
        tr:hover { background-color: var(--color-bg); }

        .result-win, .result-banker { color: var(--color-success); font-weight: 600; }
        .result-loss, .result-tie { color: var(--color-error); font-weight: 600; }
        .result-player { color: var(--color-primary); font-weight: 600; }

        .strategy-info {
            background: #f0f8ff;
            border-left: 3px solid var(--color-primary);
            padding: 12px;
            border-radius: 4px;
            font-size: 13px;
            margin-bottom: 16px;
            line-height: 1.5;
        }

        .info-title { font-weight: 600; color: var(--color-primary); margin-bottom: 6px; }

        .toggle-switch { display: flex; gap: 8px; margin-bottom: 16px; }

        .toggle-btn {
            flex: 1;
            padding: 10px;
            border: 2px solid var(--color-border);
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            font-size: 13px;
            transition: all 0.2s;
        }

        .toggle-btn.active {
            border-color: var(--color-primary);
            background-color: var(--color-primary);
            color: white;
        }

        .hidden { display: none; }

        .summary-box {
            background: var(--color-bg);
            padding: 16px;
            border-radius: 6px;
            margin-top: 16px;
            border-left: 4px solid var(--color-primary);
        }

        .summary-box strong { font-weight: 600; }

        .error-message { color: var(--color-error); font-size: 13px; margin-top: 8px; }
        .success-message { color: var(--color-success); font-size: 13px; margin-top: 8px; }
        .warning-message { color: var(--color-warning); font-size: 13px; margin-top: 8px; font-weight: 600; }

        .system-state {
            background: #e8f4fd;
            padding: 10px 12px;
            border-radius: 6px;
            margin-top: 12px;
            font-size: 13px;
        }

        .card-display {
            background: var(--color-bg);
            border-radius: 8px;
            padding: 16px;
            margin: 12px 0;
            text-align: center;
            font-size: 14px;
            font-weight: 500;
        }

        .hand-result {
            background: linear-gradient(135deg, #f5f5f0 0%, #ffffff 100%);
            padding: 16px;
            border-radius: 8px;
            margin: 12px 0;
            border-left: 4px solid var(--color-primary);
        }

        .hand-cards { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin: 12px 0; }
        .hand-section h4 { margin: 0 0 8px 0; font-size: 14px; color: var(--color-primary); }
        .hand-section p { margin: 4px 0; font-size: 13px; }

        .card-badge {
            display: inline-block;
            background: var(--color-primary);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            margin: 2px;
            font-size: 12px;
            font-weight: 600;
        }

        .guide-content { line-height: 1.7; }
        .guide-content h2 { color: var(--color-primary); border-bottom: 2px solid var(--color-border); padding-bottom: 8px; margin-top: 32px; }
        .guide-content h3 { color: var(--color-text); margin-top: 24px; }
        .guide-content h4 { color: var(--color-primary); margin-top: 20px; }
        .guide-content table { margin: 16px 0; background: white; }
        .guide-content ul, .guide-content ol { padding-left: 24px; }
        .guide-content li { margin-bottom: 8px; }
        .guide-content strong { color: var(--color-primary); }

        .guide-content .warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 12px 16px;
            border-radius: 4px;
            margin: 16px 0;
        }

        .guide-content .tip {
            background: #d4edda;
            border-left: 4px solid var(--color-success);
            padding: 12px 16px;
            border-radius: 4px;
            margin: 16px 0;
        }

        .guide-intro {
            background: linear-gradient(135deg, #f0f8ff 0%, #ffffff 100%);
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid var(--color-primary);
            margin-bottom: 24px;
        }

        .quick-ref-table { background: white; border-radius: 8px; overflow: hidden; }
        .quick-ref-table th { background: var(--color-primary); color: white; }

        .modal-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            padding: 20px;
        }

        .modal-overlay.hidden { display: none; }

        .modal-content {
            background: white;
            border-radius: 12px;
            max-width: 500px;
            width: 100%;
            padding: 32px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-content h2 { color: #d32f2f; margin: 0 0 20px 0; font-size: 22px; border: none; padding: 0; }
        .modal-content p { color: #333; line-height: 1.7; margin: 0 0 24px 0; font-size: 15px; }
        .modal-content .warning-icon { font-size: 48px; margin-bottom: 16px; }

        .modal-content .confirm-btn {
            background: linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%);
            color: white;
            border: none;
            padding: 14px 32px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .modal-content .confirm-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(211, 47, 47, 0.4);
        }

        .lang-selector {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 16px;
        }

        .lang-btn {
            padding: 8px 20px;
            border: 2px solid var(--color-border);
            background: white;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .lang-btn:hover {
            border-color: var(--color-primary);
            color: var(--color-primary);
        }

        .lang-btn.active {
            background: var(--color-primary);
            border-color: var(--color-primary);
            color: white;
        }
    </style>
</head>
<body>
    <div id="disclaimerModal" class="modal-overlay">
        <div class="modal-content">
            <div class="lang-selector">
                <button class="lang-btn active" onclick="setDisclaimerLang('en')">English</button>
                <button class="lang-btn" onclick="setDisclaimerLang('fil')">Filipino</button>
            </div>
            <div class="warning-icon">&#9888;</div>
            <div id="disclaimerEN">
                <h2>Important Disclaimer</h2>
                <p>This application is for <strong>educational and entertainment purposes only</strong>. Gambling involves significant financial risk and can be addictive. The house always has an edge - no betting system can guarantee profits.</p>
                <p style="margin-bottom: 24px;"><strong>The author takes no responsibility for any financial losses.</strong> Never gamble with money you cannot afford to lose. If you have a gambling problem, please seek help.</p>
                <button class="confirm-btn" onclick="acceptDisclaimer()">I Understand & Accept</button>
            </div>
            <div id="disclaimerFIL" class="hidden">
                <h2>Mahalagang Paalala</h2>
                <p>Ang application na ito ay para sa <strong>layuning pang-edukasyon at libangan lamang</strong>. Ang pagsusugal ay may malaking panganib sa pananalapi at maaaring maging adiktibo. Ang casino ay palaging may kalamangan - walang betting system ang makakagarantiya ng tubo.</p>
                <p style="margin-bottom: 24px;"><strong>Ang may-akda ay walang pananagutan sa anumang pagkalugi.</strong> Huwag magsugal ng perang hindi mo kayang mawala. Kung may problema ka sa pagsusugal, humingi ng tulong.</p>
                <button class="confirm-btn" onclick="acceptDisclaimer()">Naiintindihan Ko at Tinatanggap</button>
            </div>
        </div>
    </div>

    <div class="container">
        <header>
            <h1>Baccarat Pro</h1>
            <div class="header-subtitle">Strategy Tracker, Simulator & Guide - Philippine Peso Edition</div>

            <div class="nav-tabs">
                <button class="nav-tab active" onclick="showTab('tracker')">Strategy Tracker</button>
                <button class="nav-tab" onclick="showTab('simulator')">Simulator</button>
                <button class="nav-tab" onclick="showTab('guide')">Strategy Guide</button>
            </div>
        </header>

        <!-- STRATEGY TRACKER TAB -->
        <div id="tracker" class="tab-content active">
            <div class="grid">
                <div class="card">
                    <h2>Setup & Control</h2>

                    <div class="toggle-switch">
                        <button class="toggle-btn active" onclick="setStrategy('banker', this)">Bet: Banker</button>
                        <button class="toggle-btn" onclick="setStrategy('player', this)">Bet: Player</button>
                    </div>

                    <div class="form-group">
                        <label>Initial Bankroll (₱)</label>
                        <input type="number" id="initialBankroll" value="5000" min="100" step="100">
                    </div>

                    <div class="form-group">
                        <label>Base Bet Unit (₱)</label>
                        <input type="number" id="baseBet" value="100" min="10" step="10">
                    </div>

                    <div class="form-group">
                        <label>Betting System</label>
                        <select id="system" onchange="updateSystemInfo()">
                            <option value="flat">Flat Betting (Same Every Hand)</option>
                            <option value="martingale">Martingale (Double After Loss)</option>
                            <option value="paroli">Paroli (Double After Win)</option>
                            <option value="fibonacci">Fibonacci (Sequence)</option>
                            <option value="1324">1-3-2-4 System</option>
                        </select>
                    </div>

                    <div id="systemInfo" class="strategy-info hidden">
                        <div class="info-title" id="sysTitle"></div>
                        <div id="sysDesc"></div>
                    </div>

                    <div class="form-group">
                        <label>Max Bet Limit (₱)</label>
                        <input type="number" id="maxBet" value="10000" min="100" step="100">
                    </div>

                    <div class="button-group">
                        <button class="btn-primary" onclick="resetSession()">Reset Session</button>
                    </div>
                </div>

                <div class="card">
                    <h2>Session Stats</h2>

                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-label">Current Bankroll</div>
                            <div class="stat-value" id="currentBankroll">₱5,000</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">Total Hands</div>
                            <div class="stat-value" id="totalHands">0</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">Win Rate</div>
                            <div class="stat-value" id="winRate">0%</div>
                        </div>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-label">Wins</div>
                            <div class="stat-value result-win" id="winCount">0</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">Losses</div>
                            <div class="stat-value result-loss" id="lossCount">0</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">Profit/Loss</div>
                            <div class="stat-value" id="profitLoss" style="color: #666;">₱0</div>
                        </div>
                    </div>

                    <div class="summary-box">
                        <div><strong>Next Bet:</strong> <span id="nextBet">₱100</span></div>
                        <div style="margin-top: 8px;"><strong>Strategy:</strong> <span id="currentStrategy">Banker + Flat</span></div>
                    </div>

                    <div id="systemState" class="system-state hidden"></div>
                </div>
            </div>

            <div class="card">
                <h2>Record Bet Result</h2>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                    <div class="form-group">
                        <label>Bet Type</label>
                        <select id="betType">
                            <option value="banker">Banker</option>
                            <option value="player">Player</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Bet Amount (₱)</label>
                        <input type="number" id="betAmount" value="100" min="10" step="10">
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn-primary" onclick="recordResult('win')">WIN</button>
                    <button class="btn-primary" style="background-color: var(--color-error);" onclick="recordResult('loss')">LOSS</button>
                    <button class="btn-secondary btn-small" onclick="undoLastBet()">Undo</button>
                </div>
                <div id="message"></div>
            </div>

            <div class="card">
                <h2>Bet History</h2>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Type</th>
                                <th>Bet</th>
                                <th>Result</th>
                                <th>P/L</th>
                                <th>Balance</th>
                            </tr>
                        </thead>
                        <tbody id="historyTable">
                            <tr>
                                <td colspan="6" style="text-align: center; color: var(--color-text-light);">No bets yet. Start recording!</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card">
                <h2>Quick Tips</h2>
                <ul style="margin: 0; padding-left: 20px; font-size: 14px; line-height: 1.6; color: var(--color-text-light);">
                    <li><strong>Banker Edge:</strong> Banker has ~1.06% house edge vs Player ~1.24%</li>
                    <li><strong>Avoid Tie:</strong> Tie bets have ~14% house edge</li>
                    <li><strong>Stop-Loss:</strong> Stop if you lose 50% of your starting bankroll</li>
                    <li><strong>Win Goal:</strong> Aim for +30-50% gains, then walk away</li>
                </ul>
            </div>
        </div>

        <!-- SIMULATOR TAB -->
        <div id="simulator" class="tab-content">
            <div class="grid">
                <div class="card">
                    <h2>Simulation Settings</h2>

                    <div class="form-group">
                        <label>Number of Decks</label>
                        <select id="numDecks">
                            <option value="6" selected>6 Decks (Standard)</option>
                            <option value="8">8 Decks</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Banker Commission (%)</label>
                        <input type="number" id="commission" value="5" min="0" max="10" step="0.5">
                    </div>

                    <div class="form-group">
                        <label>Hands to Simulate</label>
                        <input type="number" id="handsToSim" value="100" min="1" max="10000" step="1">
                    </div>

                    <div class="form-group">
                        <label>Base Bet (₱)</label>
                        <input type="number" id="baseBetSim" value="100" min="10" step="10">
                    </div>

                    <div class="form-group">
                        <label>Max Bet Limit (₱)</label>
                        <input type="number" id="maxBetSim" value="10000" min="100" step="100">
                    </div>

                    <div class="form-group">
                        <label>Betting System</label>
                        <select id="systemSim">
                            <option value="flat">Flat Betting</option>
                            <option value="martingale">Martingale</option>
                            <option value="paroli">Paroli</option>
                            <option value="fibonacci">Fibonacci</option>
                            <option value="1324">1-3-2-4 System</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Bet On</label>
                        <select id="simBetOn">
                            <option value="banker">Always Banker</option>
                            <option value="player">Always Player</option>
                        </select>
                    </div>

                    <div class="button-group">
                        <button class="btn-primary" onclick="runSimulation()">Run Simulation</button>
                        <button class="btn-secondary" onclick="resetSimulation()">Reset</button>
                    </div>
                </div>

                <div class="card">
                    <h2>Simulation Results</h2>

                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-label">Hands Played</div>
                            <div class="stat-value" id="simHandsPlayed">0</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">Total Wagered</div>
                            <div class="stat-value" id="simTotalWagered">₱0</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">Max Bet Used</div>
                            <div class="stat-value" id="simMaxBetUsed">₱0</div>
                        </div>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-label">Banker Wins</div>
                            <div class="stat-value result-banker" id="simBankerWins">0</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">Player Wins</div>
                            <div class="stat-value result-player" id="simPlayerWins">0</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">Ties</div>
                            <div class="stat-value result-tie" id="simTies">0</div>
                        </div>
                    </div>

                    <div class="summary-box">
                        <div><strong>Net Profit/Loss:</strong> <span id="simProfitLoss">₱0</span></div>
                        <div style="margin-top: 8px;"><strong>ROI:</strong> <span id="simROI">0%</span></div>
                        <div style="margin-top: 8px;"><strong>Bet Wins:</strong> <span id="simBetWins">0</span> | <strong>Bet Losses:</strong> <span id="simBetLosses">0</span></div>
                    </div>

                    <div id="simWarning" class="warning-message hidden"></div>
                </div>
            </div>

            <div class="card">
                <h2>Play Single Hand</h2>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                    <div class="form-group">
                        <label>Your Bet (₱)</label>
                        <input type="number" id="singleBet" value="100" min="10" step="10">
                    </div>

                    <div class="form-group">
                        <label>Bet On</label>
                        <select id="singleBetType">
                            <option value="banker">Banker</option>
                            <option value="player">Player</option>
                            <option value="tie">Tie (8:1)</option>
                        </select>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn-primary" onclick="playOneHand()">Deal Hand</button>
                </div>

                <div id="singleHandResult" class="hidden">
                    <div class="hand-result">
                        <h3 id="handOutcome" style="margin: 0 0 16px 0;"></h3>

                        <div class="hand-cards">
                            <div class="hand-section">
                                <h4>Player's Hand</h4>
                                <p><span id="playerCards"></span></p>
                                <p style="font-weight: 600; margin-top: 8px;">Total: <span id="playerTotal">0</span></p>
                            </div>
                            <div class="hand-section">
                                <h4>Banker's Hand</h4>
                                <p><span id="bankerCards"></span></p>
                                <p style="font-weight: 600; margin-top: 8px;">Total: <span id="bankerTotal">0</span></p>
                            </div>
                        </div>

                        <div class="card-display" id="resultMessage"></div>
                        <div id="winLossMessage"></div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>Last 20 Simulated Hands</h2>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Winner</th>
                                <th>Player</th>
                                <th>Banker</th>
                                <th>Your Bet</th>
                                <th>Result</th>
                            </tr>
                        </thead>
                        <tbody id="simHistoryTable">
                            <tr>
                                <td colspan="6" style="text-align: center; color: var(--color-text-light);">No hands yet.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card">
                <h2>How Baccarat Works</h2>
                <ul style="margin: 0; padding-left: 20px; font-size: 14px; line-height: 1.6; color: var(--color-text-light);">
                    <li><strong>Card Values:</strong> A=1, 2-9=face value, 10/J/Q/K=0. Total = last digit of sum.</li>
                    <li><strong>Natural:</strong> 8 or 9 on first 2 cards = automatic stand.</li>
                    <li><strong>Player Rule:</strong> Draws on 0-5, stands on 6-7.</li>
                    <li><strong>Banker Rule:</strong> Complex rules based on Player's third card.</li>
                    <li><strong>Banker Wins:</strong> Pays 1:1 minus 5% commission.</li>
                    <li><strong>Player Wins:</strong> Pays 1:1 (no commission).</li>
                    <li><strong>Tie:</strong> Usually pays 8:1.</li>
                </ul>
            </div>
        </div>

        <!-- GUIDE TAB -->
        <div id="guide" class="tab-content">
            <div class="card guide-content">
                <div class="guide-intro">
                    <h2 style="margin-top: 0; border: none; padding: 0;">Baccarat Betting Systems Guide</h2>
                    <p>Understand each betting system, how it works, and when to use it. Remember: <strong>no system beats the house edge</strong> - these simply structure your bet sizing.</p>
                </div>

                <h2>1. Flat Betting (Baseline)</h2>
                <p>The simplest approach - bet the same amount every hand.</p>
                <ul>
                    <li><strong>Logic:</strong> Always bet your base unit regardless of wins or losses</li>
                    <li><strong>Risk Level:</strong> Low</li>
                    <li><strong>Best For:</strong> Conservative players, learning the game</li>
                </ul>
                <div class="tip">
                    <strong>Example:</strong> Base ₱100<br>
                    Hand 1: Bet ₱100, LOSE → Balance: -₱100<br>
                    Hand 2: Bet ₱100, WIN → Balance: ₱0<br>
                    Hand 3: Bet ₱100, WIN → Balance: +₱100
                </div>

                <h2>2. Martingale (Negative Progression)</h2>
                <p>Double your bet after every LOSS. Reset to base after a WIN.</p>
                <ul>
                    <li><strong>After LOSS:</strong> Double the bet (bet = base × 2^losses)</li>
                    <li><strong>After WIN:</strong> Reset to base unit</li>
                    <li><strong>Risk Level:</strong> HIGH - bets escalate very quickly</li>
                    <li><strong>Danger Zone:</strong> 7+ consecutive losses requires 128× base bet</li>
                </ul>
                <div class="warning">
                    <strong>Example:</strong> Base ₱100<br>
                    Hand 1: Bet ₱100, LOSE → losses=1, Balance: -₱100<br>
                    Hand 2: Bet ₱200, LOSE → losses=2, Balance: -₱300<br>
                    Hand 3: Bet ₱400, WIN → losses=0, Balance: +₱100 (recovered!)<br>
                    Hand 4: Bet ₱100, LOSE → losses=1, Balance: ₱0<br><br>
                    <strong>Warning:</strong> After 6 losses you need ₱6,400 to continue!
                </div>

                <h2>3. Paroli (Positive Progression)</h2>
                <p>Double your bet after every WIN. Reset after a LOSS OR after 3 consecutive wins.</p>
                <ul>
                    <li><strong>After WIN:</strong> Double the bet (up to 3 wins)</li>
                    <li><strong>After LOSS:</strong> Reset to base unit</li>
                    <li><strong>After 3 WINS:</strong> Reset to base unit (lock profits)</li>
                    <li><strong>Risk Level:</strong> Low-Medium - losses only cost base unit</li>
                </ul>
                <div class="tip">
                    <strong>Example:</strong> Base ₱100<br>
                    Hand 1: Bet ₱100, WIN → wins=1, Balance: +₱100, next=₱200<br>
                    Hand 2: Bet ₱200, WIN → wins=2, Balance: +₱300, next=₱400<br>
                    Hand 3: Bet ₱400, WIN → wins=3, Balance: +₱700, RESET!<br>
                    Hand 4: Bet ₱100, LOSE → wins=0, Balance: +₱600<br><br>
                    <strong>Key:</strong> You risk house money after wins, not your own!
                </div>

                <h2>4. Fibonacci (Negative Progression)</h2>
                <p>Use the Fibonacci sequence: 1, 1, 2, 3, 5, 8, 13, 21, 34...</p>
                <ul>
                    <li><strong>After LOSS:</strong> Move forward ONE step in sequence</li>
                    <li><strong>After WIN:</strong> Move back TWO steps in sequence</li>
                    <li><strong>If below step 0:</strong> Reset to step 0</li>
                    <li><strong>Risk Level:</strong> Medium - slower escalation than Martingale</li>
                </ul>
                <div class="tip">
                    <strong>Sequence:</strong> 1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89...<br><br>
                    <strong>Example:</strong> Base ₱100<br>
                    Hand 1: Bet ₱100 (×1), LOSE → index=1<br>
                    Hand 2: Bet ₱100 (×1), LOSE → index=2<br>
                    Hand 3: Bet ₱200 (×2), LOSE → index=3<br>
                    Hand 4: Bet ₱300 (×3), WIN → index=1 (back 2 steps)<br>
                    Hand 5: Bet ₱100 (×1), WIN → index=0, RESET!
                </div>

                <h2>5. 1-3-2-4 System (Fixed Sequence)</h2>
                <p>Bet in a fixed sequence: 1 unit → 3 units → 2 units → 4 units.</p>
                <ul>
                    <li><strong>After WIN:</strong> Move to next step in sequence</li>
                    <li><strong>After LOSS:</strong> Reset to step 0 (1 unit)</li>
                    <li><strong>After completing step 4:</strong> Reset to step 0</li>
                    <li><strong>Risk Level:</strong> Medium - clever profit protection at step 3</li>
                </ul>
                <div class="tip">
                    <strong>The Magic:</strong> Step 3 is only 2 units (not 4), so if you lose at step 4 you still keep profit!<br><br>
                    <strong>Example:</strong> Base ₱100<br>
                    Step 0: Bet ₱100 (×1), WIN → step=1, Balance: +₱100<br>
                    Step 1: Bet ₱300 (×3), WIN → step=2, Balance: +₱400<br>
                    Step 2: Bet ₱200 (×2), WIN → step=3, Balance: +₱600<br>
                    Step 3: Bet ₱400 (×4), LOSE → step=0, Balance: +₱200 (still profit!)<br><br>
                    <strong>Full sequence win:</strong> 1+3+2+4 = 10 units profit!
                </div>

                <h2>Quick Reference</h2>
                <div class="table-wrapper">
                    <table class="quick-ref-table">
                        <thead>
                            <tr>
                                <th>System</th>
                                <th>Type</th>
                                <th>After Win</th>
                                <th>After Loss</th>
                                <th>Risk</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>Flat</td><td>None</td><td>Same bet</td><td>Same bet</td><td>Low</td></tr>
                            <tr><td>Martingale</td><td>Negative</td><td>Reset to base</td><td>Double bet</td><td>High</td></tr>
                            <tr><td>Paroli</td><td>Positive</td><td>Double (max 3×)</td><td>Reset to base</td><td>Low</td></tr>
                            <tr><td>Fibonacci</td><td>Negative</td><td>Back 2 steps</td><td>Forward 1 step</td><td>Medium</td></tr>
                            <tr><td>1-3-2-4</td><td>Fixed</td><td>Next step</td><td>Reset to step 0</td><td>Medium</td></tr>
                        </tbody>
                    </table>
                </div>

                <h2>Bankroll Management</h2>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Parameter</th>
                                <th>Recommended</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td><strong>Session Budget</strong></td><td>₱5,000</td><td>Total amount for the session</td></tr>
                            <tr><td><strong>Unit Size</strong></td><td>₱100 (2%)</td><td>1-2% of bankroll</td></tr>
                            <tr><td><strong>Stop-Loss</strong></td><td>50%</td><td>Stop when down ₱2,500</td></tr>
                            <tr><td><strong>Win Goal</strong></td><td>+30-50%</td><td>Stop when up ₱1,500-2,500</td></tr>
                        </tbody>
                    </table>
                </div>

                <h2>House Edge</h2>
                <ul>
                    <li><strong>Banker:</strong> 1.06% (best bet)</li>
                    <li><strong>Player:</strong> 1.24%</li>
                    <li><strong>Tie:</strong> ~14% (avoid!)</li>
                </ul>

                <p style="margin-top: 32px; padding: 16px; background: var(--color-bg); border-radius: 8px; font-style: italic; color: var(--color-text-light);">
                    This app is for educational and entertainment purposes only. Gambling involves risk - never wager more than you can afford to lose.
                </p>
            </div>
        </div>
    </div>

    <script>
        // =====================
        // UTILITY FUNCTIONS
        // =====================
        function formatPeso(amount) {
            const absAmount = Math.abs(Math.round(amount));
            const formatted = absAmount.toLocaleString('en-PH');
            return (amount < 0 ? '-₱' : '₱') + formatted;
        }

        // Fibonacci sequence
        const FIBONACCI = [1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, 233, 377, 610, 987];
        const SEQUENCE_1324 = [1, 3, 2, 4];

        // =====================
        // TAB NAVIGATION
        // =====================
        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
        }

        // =====================
        // BETTING SYSTEM LOGIC
        // =====================

        // FLAT BETTING: Same bet every hand
        function flatBetting(state, result) {
            return { nextBet: state.baseBet };
        }

        // MARTINGALE: Double after LOSS, reset after WIN
        function martingale(state, result) {
            if (result === 'win') {
                return { nextBet: state.baseBet, consecutiveLosses: 0 };
            } else {
                const newLosses = (state.consecutiveLosses || 0) + 1;
                const nextBet = Math.min(state.baseBet * Math.pow(2, newLosses), state.maxBet);
                return { nextBet, consecutiveLosses: newLosses };
            }
        }

        // PAROLI: Double after WIN (max 3), reset after LOSS
        function paroli(state, result) {
            if (result === 'win') {
                const newWins = (state.consecutiveWins || 0) + 1;
                if (newWins >= 3) {
                    return { nextBet: state.baseBet, consecutiveWins: 0 };
                } else {
                    const nextBet = Math.min(state.baseBet * Math.pow(2, newWins), state.maxBet);
                    return { nextBet, consecutiveWins: newWins };
                }
            } else {
                return { nextBet: state.baseBet, consecutiveWins: 0 };
            }
        }

        // FIBONACCI: Forward 1 on LOSS, back 2 on WIN
        function fibonacci(state, result) {
            let fibIndex = state.fibIndex || 0;
            if (result === 'win') {
                fibIndex = Math.max(0, fibIndex - 2);
            } else {
                fibIndex = Math.min(fibIndex + 1, FIBONACCI.length - 1);
            }
            const nextBet = Math.min(state.baseBet * FIBONACCI[fibIndex], state.maxBet);
            return { nextBet, fibIndex };
        }

        // 1-3-2-4: Fixed sequence, reset on LOSS or completion
        function oneThreeTwoFour(state, result) {
            let stepIndex = state.stepIndex || 0;
            if (result === 'win') {
                stepIndex = (stepIndex + 1) % 4;
            } else {
                stepIndex = 0;
            }
            const nextBet = Math.min(state.baseBet * SEQUENCE_1324[stepIndex], state.maxBet);
            return { nextBet, stepIndex };
        }

        // Apply system based on type
        function applySystem(systemType, state, result) {
            switch (systemType) {
                case 'flat': return flatBetting(state, result);
                case 'martingale': return martingale(state, result);
                case 'paroli': return paroli(state, result);
                case 'fibonacci': return fibonacci(state, result);
                case '1324': return oneThreeTwoFour(state, result);
                default: return flatBetting(state, result);
            }
        }

        // =====================
        // STRATEGY TRACKER STATE
        // =====================
        let trackerState = {
            initialBankroll: 5000,
            currentBankroll: 5000,
            baseBet: 100,
            maxBet: 10000,
            system: 'flat',
            betPreference: 'banker',
            hands: [],
            nextBet: 100,
            consecutiveLosses: 0,
            consecutiveWins: 0,
            fibIndex: 0,
            stepIndex: 0
        };

        const systemInfo = {
            flat: { title: 'Flat Betting', desc: 'Bet the same amount every hand. Safest approach.' },
            martingale: { title: 'Martingale (High Risk)', desc: 'Double bet after each LOSS. Reset to base after WIN. Warning: Bets escalate rapidly!' },
            paroli: { title: 'Paroli (Recommended)', desc: 'Double bet after each WIN (up to 3). Reset after LOSS. You risk house money, not yours!' },
            fibonacci: { title: 'Fibonacci', desc: 'Use Fibonacci sequence. Forward 1 step on LOSS, back 2 steps on WIN.' },
            '1324': { title: '1-3-2-4 System', desc: 'Bet sequence: 1→3→2→4 units. Reset on LOSS or after completing sequence.' }
        };

        function setStrategy(type, btn) {
            trackerState.betPreference = type;
            document.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            document.getElementById('betType').value = type;
            updateTrackerDisplay();
        }

        function updateSystemInfo() {
            trackerState.system = document.getElementById('system').value;
            const info = systemInfo[trackerState.system];
            document.getElementById('sysTitle').textContent = info.title;
            document.getElementById('sysDesc').textContent = info.desc;
            document.getElementById('systemInfo').classList.remove('hidden');
            resetSession();
        }

        function getSystemStateText() {
            switch (trackerState.system) {
                case 'martingale':
                    return `<strong>Consecutive Losses:</strong> ${trackerState.consecutiveLosses}`;
                case 'paroli':
                    return `<strong>Consecutive Wins:</strong> ${trackerState.consecutiveWins}/3`;
                case 'fibonacci':
                    return `<strong>Fibonacci Index:</strong> ${trackerState.fibIndex} (×${FIBONACCI[trackerState.fibIndex]})`;
                case '1324':
                    return `<strong>Step:</strong> ${trackerState.stepIndex + 1}/4 (×${SEQUENCE_1324[trackerState.stepIndex]})`;
                default:
                    return '';
            }
        }

        function recordResult(result) {
            const betAmount = parseInt(document.getElementById('betAmount').value) || 0;
            const betType = document.getElementById('betType').value;

            if (betAmount <= 0) {
                showMessage('Enter a valid bet amount', 'error');
                return;
            }

            if (result === 'loss' && trackerState.currentBankroll < betAmount) {
                showMessage('Insufficient bankroll!', 'error');
                return;
            }

            // Calculate payout (Banker pays 0.95:1 due to commission)
            let payout = 0;
            if (result === 'win') {
                payout = betType === 'banker' ? Math.floor(betAmount * 0.95) : betAmount;
                trackerState.currentBankroll += payout;
            } else {
                payout = -betAmount;
                trackerState.currentBankroll -= betAmount;
            }

            // Record hand
            trackerState.hands.push({
                type: betType,
                amount: betAmount,
                result: result,
                payout: payout,
                bankroll: trackerState.currentBankroll
            });

            // Update system state
            const systemResult = applySystem(trackerState.system, trackerState, result);
            Object.assign(trackerState, systemResult);

            showMessage(result === 'win' ? `WIN! +${formatPeso(payout)}` : `LOSS: ${formatPeso(payout)}`, result === 'win' ? 'success' : 'error');

            // Warning for dangerous Martingale levels
            if (trackerState.system === 'martingale' && trackerState.consecutiveLosses >= 5) {
                showMessage(`Warning: ${trackerState.consecutiveLosses} consecutive losses!`, 'warning');
            }

            updateTrackerDisplay();
            document.getElementById('betAmount').value = trackerState.nextBet;
        }

        function undoLastBet() {
            if (trackerState.hands.length === 0) {
                showMessage('No bets to undo', 'error');
                return;
            }

            const lastHand = trackerState.hands.pop();
            trackerState.currentBankroll -= lastHand.payout;

            // Recalculate system state from scratch
            resetSystemState();
            trackerState.hands.forEach(hand => {
                const systemResult = applySystem(trackerState.system, trackerState, hand.result);
                Object.assign(trackerState, systemResult);
            });

            showMessage('Last bet undone', 'success');
            updateTrackerDisplay();
            document.getElementById('betAmount').value = trackerState.nextBet;
        }

        function resetSystemState() {
            trackerState.consecutiveLosses = 0;
            trackerState.consecutiveWins = 0;
            trackerState.fibIndex = 0;
            trackerState.stepIndex = 0;
            trackerState.nextBet = trackerState.baseBet;
        }

        function resetSession() {
            trackerState.initialBankroll = parseInt(document.getElementById('initialBankroll').value) || 5000;
            trackerState.currentBankroll = trackerState.initialBankroll;
            trackerState.baseBet = parseInt(document.getElementById('baseBet').value) || 100;
            trackerState.maxBet = parseInt(document.getElementById('maxBet').value) || 10000;
            trackerState.hands = [];
            resetSystemState();
            updateTrackerDisplay();
            document.getElementById('betAmount').value = trackerState.nextBet;
            showMessage('Session reset!', 'success');
        }

        function updateTrackerDisplay() {
            document.getElementById('currentBankroll').textContent = formatPeso(trackerState.currentBankroll);
            document.getElementById('totalHands').textContent = trackerState.hands.length;

            const wins = trackerState.hands.filter(h => h.result === 'win').length;
            const losses = trackerState.hands.filter(h => h.result === 'loss').length;
            const winRate = trackerState.hands.length > 0 ? Math.round((wins / trackerState.hands.length) * 100) : 0;

            document.getElementById('winCount').textContent = wins;
            document.getElementById('lossCount').textContent = losses;
            document.getElementById('winRate').textContent = winRate + '%';

            const profitLoss = trackerState.currentBankroll - trackerState.initialBankroll;
            const profitElement = document.getElementById('profitLoss');
            profitElement.textContent = formatPeso(profitLoss);
            profitElement.style.color = profitLoss >= 0 ? '#22b55e' : '#d32f2f';

            document.getElementById('nextBet').textContent = formatPeso(trackerState.nextBet);

            const strategyName = trackerState.betPreference.charAt(0).toUpperCase() + trackerState.betPreference.slice(1);
            document.getElementById('currentStrategy').textContent = `${strategyName} + ${systemInfo[trackerState.system].title}`;

            // System state display
            const stateText = getSystemStateText();
            const stateDiv = document.getElementById('systemState');
            if (stateText && trackerState.system !== 'flat') {
                stateDiv.innerHTML = stateText;
                stateDiv.classList.remove('hidden');
            } else {
                stateDiv.classList.add('hidden');
            }

            updateHistoryTable();
        }

        function updateHistoryTable() {
            const tbody = document.getElementById('historyTable');

            if (trackerState.hands.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: var(--color-text-light);">No bets yet. Start recording!</td></tr>';
                return;
            }

            tbody.innerHTML = trackerState.hands.slice().reverse().map((hand, i) => `
                <tr>
                    <td>${trackerState.hands.length - i}</td>
                    <td>${hand.type.charAt(0).toUpperCase() + hand.type.slice(1)}</td>
                    <td>${formatPeso(hand.amount)}</td>
                    <td><span class="${hand.result === 'win' ? 'result-win' : 'result-loss'}">${hand.result.toUpperCase()}</span></td>
                    <td style="color: ${hand.payout >= 0 ? '#22b55e' : '#d32f2f'}">${formatPeso(hand.payout)}</td>
                    <td>${formatPeso(hand.bankroll)}</td>
                </tr>
            `).join('');
        }

        function showMessage(text, type) {
            const msg = document.getElementById('message');
            msg.textContent = text;
            msg.className = type === 'error' ? 'error-message' : (type === 'warning' ? 'warning-message' : 'success-message');
            setTimeout(() => msg.textContent = '', 4000);
        }

        // =====================
        // SIMULATOR
        // =====================
        const CARD_VALUES = { 'A': 1, '2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8, '9': 9, '10': 0, 'J': 0, 'Q': 0, 'K': 0 };
        const SUITS = ['♠', '♥', '♦', '♣'];

        let simState = { hands: [] };

        function createDeck() {
            const cards = [];
            const ranks = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
            for (let i = 0; i < ranks.length; i++) {
                for (let j = 0; j < SUITS.length; j++) {
                    cards.push(ranks[i] + SUITS[j]);
                }
            }
            return cards;
        }

        function shuffleDeck(deck) {
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
            return deck;
        }

        function getCardValue(card) {
            const rank = card.slice(0, -1);
            return CARD_VALUES[rank] || 0;
        }

        function calculateScore(cards) {
            return cards.reduce((sum, card) => sum + getCardValue(card), 0) % 10;
        }

        function dealHand(deck) {
            const playerCards = [deck.pop(), deck.pop()];
            const bankerCards = [deck.pop(), deck.pop()];

            let playerScore = calculateScore(playerCards);
            let bankerScore = calculateScore(bankerCards);

            // Natural check
            if (playerScore >= 8 || bankerScore >= 8) {
                return { playerCards, bankerCards, playerScore, bankerScore, deck };
            }

            // Player draws on 0-5
            let playerThird = null;
            if (playerScore <= 5) {
                playerCards.push(deck.pop());
                playerThird = getCardValue(playerCards[2]);
                playerScore = calculateScore(playerCards);
            }

            // Banker drawing rules
            if (playerThird === null) {
                if (bankerScore <= 5) {
                    bankerCards.push(deck.pop());
                    bankerScore = calculateScore(bankerCards);
                }
            } else {
                let bankerDraws = false;
                if (bankerScore <= 2) bankerDraws = true;
                else if (bankerScore === 3 && playerThird !== 8) bankerDraws = true;
                else if (bankerScore === 4 && playerThird >= 2 && playerThird <= 7) bankerDraws = true;
                else if (bankerScore === 5 && playerThird >= 4 && playerThird <= 7) bankerDraws = true;
                else if (bankerScore === 6 && playerThird >= 6 && playerThird <= 7) bankerDraws = true;

                if (bankerDraws) {
                    bankerCards.push(deck.pop());
                    bankerScore = calculateScore(bankerCards);
                }
            }

            return { playerCards, bankerCards, playerScore, bankerScore, deck };
        }

        function playOneHand() {
            const numDecks = parseInt(document.getElementById('numDecks').value) || 6;
            const bet = parseInt(document.getElementById('singleBet').value) || 100;
            const betType = document.getElementById('singleBetType').value;
            const commission = parseFloat(document.getElementById('commission').value) || 5;

            let deck = [];
            for (let i = 0; i < numDecks; i++) deck = deck.concat(createDeck());
            deck = shuffleDeck(deck);

            const hand = dealHand(deck);
            const { playerCards, bankerCards, playerScore, bankerScore } = hand;

            let winner = '';
            let payout = 0;

            if (playerScore > bankerScore) {
                winner = 'Player';
                if (betType === 'player') payout = bet;
                else if (betType === 'tie') payout = -bet;
                else payout = -bet;
            } else if (bankerScore > playerScore) {
                winner = 'Banker';
                if (betType === 'banker') payout = bet * (1 - commission / 100);
                else if (betType === 'tie') payout = -bet;
                else payout = -bet;
            } else {
                winner = 'Tie';
                if (betType === 'tie') payout = bet * 8;
                else payout = 0;
            }

            // Display
            const resultDiv = document.getElementById('singleHandResult');
            document.getElementById('handOutcome').textContent = `${winner} Wins!`;
            document.getElementById('handOutcome').style.color = winner === 'Banker' ? '#22b55e' : (winner === 'Player' ? '#1f5c7f' : '#d32f2f');

            document.getElementById('playerCards').innerHTML = playerCards.map(c => `<span class="card-badge">${c}</span>`).join('');
            document.getElementById('playerTotal').textContent = playerScore;
            document.getElementById('bankerCards').innerHTML = bankerCards.map(c => `<span class="card-badge">${c}</span>`).join('');
            document.getElementById('bankerTotal').textContent = bankerScore;

            let message = '';
            if (payout > 0) {
                message = `You WIN ${formatPeso(payout)}!`;
                document.getElementById('winLossMessage').innerHTML = `<div class="success-message" style="text-align: center; font-weight: 600; margin-top: 16px;">+${formatPeso(payout)}</div>`;
            } else if (payout < 0) {
                message = `You LOSE ${formatPeso(Math.abs(payout))}`;
                document.getElementById('winLossMessage').innerHTML = `<div class="error-message" style="text-align: center; font-weight: 600; margin-top: 16px;">${formatPeso(payout)}</div>`;
            } else {
                message = `PUSH - Bet returned`;
                document.getElementById('winLossMessage').innerHTML = `<div style="text-align: center; color: var(--color-text-light); font-weight: 600; margin-top: 16px;">₱0</div>`;
            }

            document.getElementById('resultMessage').textContent = message;
            resultDiv.classList.remove('hidden');

            simState.hands.push({ winner, banker: bankerScore, player: playerScore, bet, betType, result: payout > 0 ? 'win' : (payout < 0 ? 'loss' : 'push') });
            if (simState.hands.length > 20) simState.hands.shift();
            updateSimHistoryTable();
        }

        function runSimulation() {
            const numDecks = parseInt(document.getElementById('numDecks').value) || 6;
            const handsCount = parseInt(document.getElementById('handsToSim').value) || 100;
            const baseBet = parseInt(document.getElementById('baseBetSim').value) || 100;
            const maxBet = parseInt(document.getElementById('maxBetSim').value) || 10000;
            const systemType = document.getElementById('systemSim').value;
            const betOn = document.getElementById('simBetOn').value;
            const commission = parseFloat(document.getElementById('commission').value) || 5;

            let deck = [];
            for (let i = 0; i < numDecks; i++) deck = deck.concat(createDeck());
            deck = shuffleDeck(deck);

            let balance = 0;
            let totalWagered = 0;
            let maxBetUsed = baseBet;
            let bankerWins = 0, playerWins = 0, ties = 0;
            let betWins = 0, betLosses = 0;

            // System state
            let sysState = { baseBet, maxBet, consecutiveLosses: 0, consecutiveWins: 0, fibIndex: 0, stepIndex: 0 };
            let currentBet = baseBet;

            // Initialize for 1-3-2-4
            if (systemType === '1324') currentBet = baseBet * SEQUENCE_1324[0];

            simState.hands = [];
            let tableLimitHit = false;

            for (let i = 0; i < handsCount; i++) {
                if (deck.length < 20) {
                    deck = [];
                    for (let j = 0; j < numDecks; j++) deck = deck.concat(createDeck());
                    deck = shuffleDeck(deck);
                }

                if (currentBet > maxBetUsed) maxBetUsed = currentBet;

                const hand = dealHand(deck);
                const { playerScore, bankerScore } = hand;

                let winner = '';
                let betResult = 'loss';
                let payout = 0;

                if (playerScore > bankerScore) {
                    winner = 'Player';
                    playerWins++;
                    if (betOn === 'player') { betResult = 'win'; payout = currentBet; betWins++; }
                    else { payout = -currentBet; betLosses++; }
                } else if (bankerScore > playerScore) {
                    winner = 'Banker';
                    bankerWins++;
                    if (betOn === 'banker') { betResult = 'win'; payout = currentBet * (1 - commission / 100); betWins++; }
                    else { payout = -currentBet; betLosses++; }
                } else {
                    winner = 'Tie';
                    ties++;
                    payout = 0;
                    betResult = 'push';
                }

                totalWagered += currentBet;
                balance += payout;

                // Update system (skip ties for most systems)
                if (winner !== 'Tie') {
                    const systemResult = applySystem(systemType, { ...sysState, baseBet, maxBet }, betResult);
                    Object.assign(sysState, systemResult);
                    currentBet = sysState.nextBet || baseBet;
                }

                if (currentBet >= maxBet && !tableLimitHit) tableLimitHit = true;

                simState.hands.push({ winner, banker: bankerScore, player: playerScore, bet: currentBet, betType: betOn, result: betResult });
            }

            // Update display
            document.getElementById('simHandsPlayed').textContent = handsCount;
            document.getElementById('simTotalWagered').textContent = formatPeso(totalWagered);
            document.getElementById('simMaxBetUsed').textContent = formatPeso(maxBetUsed);
            document.getElementById('simBankerWins').textContent = bankerWins;
            document.getElementById('simPlayerWins').textContent = playerWins;
            document.getElementById('simTies').textContent = ties;
            document.getElementById('simBetWins').textContent = betWins;
            document.getElementById('simBetLosses').textContent = betLosses;

            const roi = totalWagered > 0 ? ((balance / totalWagered) * 100).toFixed(2) : 0;
            document.getElementById('simProfitLoss').textContent = formatPeso(balance);
            document.getElementById('simProfitLoss').style.color = balance >= 0 ? '#22b55e' : '#d32f2f';
            document.getElementById('simROI').textContent = roi + '%';

            const warningDiv = document.getElementById('simWarning');
            if (tableLimitHit && systemType === 'martingale') {
                warningDiv.textContent = 'Warning: Table limit was reached during simulation!';
                warningDiv.classList.remove('hidden');
            } else {
                warningDiv.classList.add('hidden');
            }

            simState.hands = simState.hands.slice(-20);
            updateSimHistoryTable();
        }

        function updateSimHistoryTable() {
            const tbody = document.getElementById('simHistoryTable');
            if (simState.hands.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: var(--color-text-light);">No hands yet.</td></tr>';
                return;
            }
            tbody.innerHTML = simState.hands.map((hand, i) => `
                <tr>
                    <td>${i + 1}</td>
                    <td><span class="result-${hand.winner.toLowerCase()}">${hand.winner}</span></td>
                    <td>${hand.player}</td>
                    <td>${hand.banker}</td>
                    <td>${formatPeso(hand.bet)} on ${hand.betType}</td>
                    <td><span class="${hand.result === 'win' ? 'result-win' : (hand.result === 'loss' ? 'result-loss' : '')}">${hand.result.toUpperCase()}</span></td>
                </tr>
            `).join('');
        }

        function resetSimulation() {
            simState = { hands: [] };
            document.getElementById('singleHandResult').classList.add('hidden');
            document.getElementById('simHandsPlayed').textContent = '0';
            document.getElementById('simTotalWagered').textContent = '₱0';
            document.getElementById('simMaxBetUsed').textContent = '₱0';
            document.getElementById('simBankerWins').textContent = '0';
            document.getElementById('simPlayerWins').textContent = '0';
            document.getElementById('simTies').textContent = '0';
            document.getElementById('simProfitLoss').textContent = '₱0';
            document.getElementById('simROI').textContent = '0%';
            document.getElementById('simBetWins').textContent = '0';
            document.getElementById('simBetLosses').textContent = '0';
            document.getElementById('simWarning').classList.add('hidden');
            updateSimHistoryTable();
        }

        // =====================
        // DISCLAIMER MODAL
        // =====================
        function setDisclaimerLang(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            if (lang === 'en') {
                document.getElementById('disclaimerEN').classList.remove('hidden');
                document.getElementById('disclaimerFIL').classList.add('hidden');
            } else {
                document.getElementById('disclaimerEN').classList.add('hidden');
                document.getElementById('disclaimerFIL').classList.remove('hidden');
            }
        }

        function acceptDisclaimer() {
            document.getElementById('disclaimerModal').classList.add('hidden');
        }

        // =====================
        // INITIALIZE
        // =====================
        updateSystemInfo();
        updateTrackerDisplay();
        updateSimHistoryTable();
    </script>
</body>
</html>
